## 웹 API 제공 서버

#### /models/domain.js

- 도메인을 등록하는 기능을 하는 도메인 모델
- validate 설정은 데이터를 추가로 검증하는 속성
- unknownType이라는 검증기 생성 (free와 premium 중 하나만 선택 가능)
- 등록한 도메인에서만 API를 사용할 수 있게 하기 위함
- 웹 브라우저에서 요청을 보낼 때, 응답을 하는 곳과 도메인이 다르면 CORS 에러 발생

#### /routes/index.js

- (GET /) 루트 라우터는 접속 시 로그인 화면을 보여줌
- (POST /domain) 폼으로부터 온 데이터를 도메인 모델에 저장

- clientSecret을 uuid 모듈을 통해 생성. uuid는 범용 고유 식별자로 고유한 문자열을 만들고 싶을 때 사용
- clientSecret에 고유한 문자열을 부여하기 위해

### JWT 토큰 인증

##### 헤더(Header).페이로드(Payload).시그니처(Signature)

- 헤더(HEADER) : 토큰 종류와 해시 알고리즘 정보가 들어있음
- 페이로드(PAYLOAD) : 토큰의 내용물이 인코딩된 부분
- 시그니처(SIGNATURE) : 일련의 문자열로, 시그니처를 통해 토큰이 변조되었는지 여부 확인

* 시그니처는 JWT 비밀키로 만들어짐. 이 비밀키가 노출되면 JWT 토큰을 위조할 수 있으므로 비밀키를 숨겨야 함 (시그니처 자체를 숨길 필요 X)
* JWT토큰은 JWT 비밀키를 알지 않는 이상 변조가 불가능함. 변조할 수 없으므로 내용물이 바뀌지 않았는지에 대해 걱정할 필요가 없음. (믿고 사용 가능함, 외부에 노출되어도 좋은 정보에 한해서)

- 단점은 용량이 크다는 것 (내용물이 들어 있기 때문)

#### /routes/middlewares.js

- 요청 헤더에 저장된 토큰 req.headers.authorization 사용
- 사용자가 쿠키처럼 헤더에 토큰을 넣어 보냄
- jwt.verify 메서드로 토큰을 검증할 수 있음 (매서드의 첫 번째 인자로 토큰, 두 번째 인자로 토큰의 비밀키를 넣음)

#### (POST /v1/token)

- 토큰 발급 라우터
- 전달받은 클라이언트 비밀키로 도메인이 등록된 것인지 먼저 확인
- 등록되지 않은 도메인이라면 에러 메시지
- 등록된 도메인이라면 토큰을 발급해서 응답
- 토큰은 jwt.sign 메서드로 발급가능 (첫 번째 인자는 토큰 내용, 두 번째 인자는 토큰의 비밀키, 세 번째 인자는 토큰의 설정(유효기간, 발급자명))

* 라우터의 이름은 v1로 버전1을 뜻함.
  한 번 버전이 정해진 후에는 라우터를 함부로 수정하면 안됨.
  다른 사람이 기존 API를 쓰고 있음을 항상 염두해두어야 함.
  기존 사용자에게 영향을 미칠 정도로 수정을 해야한다면 버전을 올린 라우터를 새로 추가하고 이전 API 사용자에게 새로운 API가 나왔음을 알려야 함
